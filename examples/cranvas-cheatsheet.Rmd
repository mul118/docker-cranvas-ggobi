---
title: "Cranvas Cheatsheet (BETA)"
output: html_document
---


# Common Interactions

Key press and release events involve setting the selection mode of the brush, changing alpha transparency, deleting selected elements, and so on. Mouse press, release, move and hover are often related to brushing and identifying cases. 

## Mouse Events

- **Left Click** - brush the plot with a rectangle brush, 
- **Right Click** - resize the brush (the cursor shape will become a cross). 
- **Scroll Wheel** - zoom in or out


## Key Events

- **Shift + ?** - toggle identify mode on or off. The cross cursor shape (+) indicates identify mode, normal cursor indicates  brush mode.
- **Plus (+)** and **Minus (-)** - increase or decrease plot's alpha transparency
- **Delete** - makes selected elements invisible, **F5** makes all elements visible.
- **A**, **O**, **X**, **N** and **C** - corresponds to the selection mode AND, OR, XOR, NOT and COMPLEMENT respectively.
- **S** - toggle between two types of brushes: (1) keeps the brush on the plot when the mouse is released, (2) hides it on mouse release. When the mouse is released, the brush history is saved (save_brush_history).

## Mode Selection

There are five selection modes, engaged by holding down the corresponding key while brushing:

1. **None** - **None** - ignore previous selection and start over on next click (default)
2. **A** - **AND** - select the intersection, i.e. the objects that are selected by two successive brushing operations
3. **O** - **OR** - select the union, i.e. any objects selected by all previous operations and the current operation
4. **X** - **XOR** - toggle the selection
5. **C** - **NOT** - negation, i.e. exclude the objects under two successive brushing operations

# Building Blocks

Cranvas plots and elements, which link together into a composite iEDA environment when applied to a common dataframe:

- **Data**
  - qdata - reactive, mutable dataframe ('mutaframe')
  - link_cat - link two mutaframes
- **1-d**
  - record_selector - browsable/selectable list
  - qhist/qspine - histogram/spineogram
  - qdensity - density plot
  - qbar - bar plot
- **2-d**
  - qscatter - scatter plot
- **N-d**
  - qparallel - parallel coordinates plot
  - qboxplot - box & whisker plot
  - /qmosaic - mosaic blot
- **Special**
  - qtime - time series plot
  - /qmval - missing value plot
  - /qmap - map plot
  - /qtour - tour

# qdata

Convert a dataframe to Cranvas's mutaframe.

```{r, eval=FALSE}
library('cranvas')
qtennis <- qdata(tennis)
qhist(double.faults, qtennis)

cranvas_off()
```

**TODO**: color by categorical variable, 


# link_cat

Link two mutaframes together (or one mutaframe to itself) by a common categorical variable so that whenever elements (rows) in a category are brushed, all elements in all dataframes containing this category will be brushed.

```{r, eval = FALSE} 
link_cat(mf1, var1, mf2 = NULL, var2 = NULL)
```

# record_selector

Record selection GUI used to select/brush one or more elements.This selector can link to any plots based on a mutaframe created by qdata.

```{r, eval=FALSE}
record_selector(wt, mtcars)
```

Interactions:

- **Up**, **Down** - move selection cursor up or down
- **Shift/Ctrl + Click** - select multiple elements



# qhist & qspine

Interactive histogram or spine plot based on a continuous variable, optionally split by a categorical variable.

```{r, eval=FALSE}
qhist(x, data, bins = 30, binwidth = NULL, breaks = NULL, ybreaks = NULL, freq = TRUE, 
    main = "", horizontal = FALSE, spine = FALSE, xlim = NULL, ylim = NULL, xlab = NULL, 
    ylab = NULL)

qspine(x, data, ...)
```

The splitting variable is usually specified in qdata as the color or border argument; if it is present, each bar in the plot will be split into categories.

Interactions:

- **Up**, **Down** - increase or decrease binwidth
- **Left**, **Right** - move bin anchor point left or right

In the identify mode, the breakpoints of the bin(s) as well as counts and proportion of cases in the bin(s) are shown as text labels in the plot.

# qdensity

Draw a univariate density plot, with a rug plot underneath.

```{r, eval=FALSE}
qdensity(x, data, binwidth = NULL, main = "", xlim = NULL, ylim = NULL, xlab = NULL, 
    ylab = NULL)
```

Interactions:

- **Up**, **Down** - increase or decrease point size
- **Left**, **Right** - decrease or increase binwidth for density
- **Z** - toggle zoom on/off

# qbar

Vertical or horizontal Bar plot for categorical variable

```{r eval=FALSE}
qbar(x, data, weight = NULL, space = 0.1, main = "", horizontal = FALSE, standardize = FALSE, xlim = NULL, ylim = NULL, xlab = NULL, ylab = NULL)
```

In the identify mode the variable and its identified values are shown as a text label in the plot, along with the counts and proportion of the identified categories. If the bar plot is split by an additional categorical variable, it will also be shown in the label.



# qscatter 

Scatterplot with two numeric variables. Supports colors and sizes specified via qdata. 

```{r, eval = FALSE} 
qscatter(x, y, data, edges = NULL, main = "", xlim = NULL, ylim = NULL, xlab = NULL, ylab = NULL, asp = 1, alpha = 1, unibrushcolor = TRUE)
```

Interactions:

- **Up**, **Down** - increase or decrease point size
- **Shift + Arrow Key** - move view in specified direction
- **Mouse Wheel** - zoom in or out of the plot



# qparallel

Parallel coordinates plot for variables in a data frame, with each line representing a row.

```{r, eval = FALSE} 
qparallel(vars = ~., data, scale = "range", names = break_str(vars), 
    na.action = na_impute, center = NULL, order = c("none", "MDS", "ANOVA", 
        "randomForest"), horizontal = FALSE, glyph = c("auto", "line", 
        "tick", "circle", "square", "triangle"), boxplot = FALSE, width = NULL, 
    jitter = NULL, amount = NULL, main = "", alpha = 1)
```

The 'scale' argument specifies the data standardizing method. Possible values are: 

- 'range' (scale columns individually to [0, 1]), 
- 'I' (do not transform; use original values), 
- 'sd' (make each column of mean 0 sd 1), and 'global' (scale all the columns to [0, 1] using global minimum and maximum)
- other character strings - custom functions

Interactions: 

- **R** - toggle the min/max labels
- **Left**, **Right** - move a variable left or right when its axis is selected by the brush
- **Up**, **Down** - flip the values of a variable (like a mirror reflection) when its axis is selected by the brush



# qboxplot

Side-by-side boxplots for all the variables in a data frame or boxplots for a continous variable vs a categorical variable.

```{r, eval = FALSE} 
qboxplot(vars, data, at = NULL, width = NULL, horizontal = FALSE, main = "", 
    xlim = NULL, ylim = NULL, xlab = NULL, ylab = NULL, points = FALSE)
```

Brushing linked plots will generate conditional boxplots showing the distributions of the brushed data.

# qtime

Time-series plot.

```{r, eval = FALSE} 
qtime(time, y, data, group = NULL, shift = c(1, 4, 7, 12, 24), alpha = 1, size = 2, 
    asp = NULL, series.stats = ifelse(nrow(data) < 1000, TRUE, FALSE), fun.base = min, 
    main = NULL, xlab = NULL, ylab = NULL, ...)
```

Interactions: 

- **Up**, **Down** - in-/de-crease size of points
- **Left**, **Right** - wrap the time series in the initial mode, and drag the series in the series selection mode
- **Shift + Right** - Time series will be folded directly to the width of maximal value in argument shift
- **Shift + Left** -  Time series will be backed to the original xaxis position
- **Plus (+)**, **Minus (-)** - de-/in-crease alpha level (starts at alpha=1 by default)
- **U**, **D** - separate/mix the series groups or the period by shifting them up and down
- **Shift + U or D** - for multivariate y's, separate/mix them by shifting up and down
- **G** - change the wrapping period circularly in the values of parameter 'shift'
- **M** - Switch the mode for series selection. Default to be off. When there are more than one series in the plot, users can turn it on to hold a series and shift the series horizontally by dragging with the mouse
- **Y**, **Shift + Y** - y-wrapping forward or backward
- **R** - switch to area plot
- **F** - fold the series to a horizon plot
- **Mouse Wheel** - Zoom in or out. Drag the series horizontally to see  details

